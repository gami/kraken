# KURAKEN

プライベートマッチでスプラトゥーンをもっと楽しむことができるアプリ

## 目的
- 今まだないスプラトゥーンの遊び方を提供する
- 初心者からトップチームまで、実力の近いチームといつでも対戦できる
- いつものチームでもっと強くなることができる。強さがわかる。

## 背景
- スプラトゥーンは実力の近いチーム同士で戦うのが楽しい
  - ウデマエ制限大会では個人のXPで制限される
  - しかし、XPはガチマッチをどれくらい頑張っているかや、マッチング相性、使用ブキなどでブレやすい
  - そのため、固定チーム戦での実力を正確に反映していない
- ガチマッチが苦しい
  - よくわからん味方とマッチングして負ける
  - 勝った時と負けた時のXP変動が不明
  - 黙々と潜り続けてXPをとかした時の徒労感 
  - Glicko2であるため、集計中/集計直後はレーティングの信頼度が低い
  - XP2700を越えようと思ったら、ある程度試合数をこなす必要がある
  - XPが上がるとマッチングするパワー幅が大きくなるので、近い実力の相手とマッチングしづらくなる
- Twitterで対抗戦を募集するのは敷居が高い
  - トラブルの懸念
  - ウデマエが低いと募集しにくい
- リーグマッチは楽しい
  - 2時間で終わってしまう、長期的な目標は持てない
  - メダルを集めることはできる
- 対戦相手や味方のXP、対戦後のレート増減が明示されないのでもやもやする

## 概要
### ターゲットプラットフォーム
- iOS
- Android
- Web (シェアページ/ランキング)

### マッチの仕様
#### レーティングマッチ
- 期間：8週間。開催ごは4週間のクーリング期間。
- ルール：エリア/おまかせロスト/4先
  - 本当はガチ4ルールx2ステージ指定/カウンターステージ（1stルル/ステのみ運営指定）/4先とかにしたいが、最初はニーズにマッチした方がいいかなと思っている・・・
  - 対戦ごとにレーティングが変動する
  - 対戦相手は近いレーティングの相手に募集/応募できる
  - 初期レーティングは最高XPで決める

#### フリーマッチ
- 常に開催
- ルールは募集者指定
- レーティング変動なし
- いろんな大会の練習試合募集とかに使えたらなあという感じ
- ルールセットを登録できるようにして、募集の時に選べるなど

### レーティング仕様
- TrueSkillのpython実装をGoでリライトする
  - Glicko2に比べて収束が早い
  - 個人のレーティングも別途算出できる
  - マイクロソフトの特許があり、商用利用禁止だが、計算式は特許を取れないので商標を使わなければ、問題ないはず。問題あるようであれば、TrueSkillライクなロジックの論文があり、そのRust実装があるので、それを参考に作る

### 認証
- Twitterアカウントでログイン

## 価値を実現できる最小限の機能構成
- ユーザー
  - 登録
  - ログイン
  - (Twitterアカウントが使えなくなったらログインできない)
  - プロフィール登録
    - 名前
    - アイコン（Twitterから）
    - フレンドコード
    - 最高XP
    - 配信サイト
    - 無線/有線
　- プロフィールページ
    - Twitterでシェアできる
- チーム
  - 作成
    - リーダー設定
    - 名前
    - Discordサーバー
    - 再編集
  - 招待
    - DeepLinkか名前で検索して追加
      - Twitter DMなどで直接誘う
      - （いずれはアプリ内で募集できてもよい）
  - チームページ
    - メンバー一覧
    - レーティング
    - 戦歴
- ランキング
  - 現在のレーティングマッチ
- マッチ
  - 募集
  - 検索
    - とりあえず新着
      - 対戦時のレート増減を表示したい
      - （将来的にはレートが増えない対戦は非表示にしたい） 
    - 応募
  - チャット
    - 対戦開始から12時間でアーカイブ化
  - 結果送信
    - 承認
  - リザルト
    - Twitterでシェアできる
  - 通報

## 発展させていきたい機能
- 即席チーム募集
- tier導入
- プロフィールを発展させて戦歴などを表示する
  - 最高XP/得意ブキ/大会実績
  - Twitterのシェア画像/動画を表示
- ギフティング
  - ステッカーをプロフページから
- コーチ
- 観戦配信（実況
- スポンサー
- カレンダー（アップデートやフェスなどの自動登録/大会）/通知(開始10分前など)
- 10勝プラベ（個人レーティングが更新される）
- 国際化
  - ローカライズ
  - JP/US/EUでマッチングを分ける
- ping値

## システム構成
- Flutter
- Firebase
- GCP
  - CloudFunction
    - Go

## 想定される問題
- 初期レーティングを適当に低く入れて格下狩り
- ラグにどう対処するか
- 第三者の観戦を許容するか
- 不正レート上げ対策をどうするか

## 参考URL
- https://smashmate.net/
- https://g-ratings.info/
- https://qiita.com/BlueRayi/items/f994bb67e0dc5723c2a1
- https://github.com/DataWraith/bbt
- https://jmlr.csail.mit.edu/papers/volume12/weng11a/weng11a.pdf

## 編集履歴
- 2020/10/03 初稿

